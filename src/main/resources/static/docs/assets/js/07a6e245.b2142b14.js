"use strict";(self.webpackChunkclias_docs=self.webpackChunkclias_docs||[]).push([[5493],{138:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"dev/frontend_app/servicios_apis","title":"App M\xf3vil SISA - Servicios y APIs","description":"En SISA, la l\xf3gica de comunicaci\xf3n con el backend y la gesti\xf3n local de datos est\xe1 encapsulada en los archivos *_service.dart.","source":"@site/docs/dev/frontend_app/servicios_apis.md","sourceDirName":"dev/frontend_app","slug":"/dev/frontend_app/servicios_apis","permalink":"/docs/dev/frontend_app/servicios_apis","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"App M\xf3vil SISA - Servicios y APIs","sidebar_label":"Servicios y APIs","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"M\xf3dulos Principales","permalink":"/docs/dev/frontend_app/modulos_principales"},"next":{"title":"Notificaciones Push","permalink":"/docs/dev/frontend_app/notificaciones_push"}}');var r=s(4848),c=s(8453);const o={title:"App M\xf3vil SISA - Servicios y APIs",sidebar_label:"Servicios y APIs",sidebar_position:3},a="Servicios y APIs",d={},l=[{value:"Descripci\xf3n general de los servicios",id:"descripci\xf3n-general-de-los-servicios",level:2},{value:"Interacci\xf3n con el backend",id:"interacci\xf3n-con-el-backend",level:2},{value:"Manejo de errores y respuestas",id:"manejo-de-errores-y-respuestas",level:2},{value:"Ejemplo de secuencia (Encuesta con modo offline)",id:"ejemplo-de-secuencia-encuesta-con-modo-offline",level:2}];function t(e){const n={blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"servicios-y-apis",children:"Servicios y APIs"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["En SISA, la l\xf3gica de comunicaci\xf3n con el backend y la gesti\xf3n local de datos est\xe1 encapsulada en los archivos ",(0,r.jsx)(n.code,{children:"*_service.dart"}),".",(0,r.jsx)(n.br,{}),"\n","Cada servicio expone funciones que permiten a la UI y a la capa de estado acceder a datos de manera uniforme y desacoplada."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"descripci\xf3n-general-de-los-servicios",children:"Descripci\xf3n general de los servicios"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"auth_service.dart"})}),": autenticaci\xf3n, emisi\xf3n y renovaci\xf3n de tokens, cierre de sesi\xf3n."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"paciente_service.dart"})}),": CRUD de informaci\xf3n de pacientes."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"chat_service.dart"})}),": manejo de mensajes en tiempo real y vinculaci\xf3n a sesiones."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"sesion_chat_service.dart"})}),": control de sesiones de chat y su historial."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"encuesta_service.dart"})}),": gesti\xf3n de encuestas de salud (creaci\xf3n, env\xedo, estado)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"inf_socioeconomica_service.dart"})}),": formularios de datos socioecon\xf3micos."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"resultado_service.dart"})}),": consulta de resultados de ex\xe1menes."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"archivo_service.dart"})}),": subida y descarga de archivos vinculados a formularios y resultados."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"resource_service.dart"})}),": acceso a recursos est\xe1ticos (gu\xedas, material de apoyo)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"ubicacion_service.dart"})}),": funciones de geolocalizaci\xf3n y env\xedo de coordenadas."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"notification_service.dart"})}),": integraci\xf3n con FCM y control del env\xedo/recepci\xf3n de notificaciones."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"firebase_messaging_handler.dart"})}),": recepci\xf3n y normalizaci\xf3n de mensajes push."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"connectivity_service.dart"})}),": verificaci\xf3n de red y soporte al modo offline."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"interacci\xf3n-con-el-backend",children:"Interacci\xf3n con el backend"}),"\n",(0,r.jsxs)(n.p,{children:["Los servicios se comunican con el backend ",(0,r.jsx)(n.strong,{children:"mediante HTTP (REST/JSON)"})," utilizando el cliente ",(0,r.jsx)(n.code,{children:"Dio"}),".",(0,r.jsx)(n.br,{}),"\n","El flujo general es:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["La ",(0,r.jsx)(n.strong,{children:"UI"})," solicita una acci\xf3n (ej. enviar encuesta)."]}),"\n",(0,r.jsxs)(n.li,{children:["El ",(0,r.jsx)(n.strong,{children:"estado"})," invoca el servicio correspondiente (",(0,r.jsx)(n.code,{children:"encuesta_service.dart"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["El servicio valida conectividad (",(0,r.jsx)(n.code,{children:"connectivity_service.dart"}),").","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Si hay red \u2192 realiza la llamada HTTP al endpoint del backend."}),"\n",(0,r.jsx)(n.li,{children:"Si no hay red \u2192 guarda un borrador en cach\xe9 para sincronizaci\xf3n posterior."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"El backend responde con datos o confirmaci\xf3n."}),"\n",(0,r.jsx)(n.li,{children:"El servicio transforma la respuesta en modelos locales y los entrega al estado/UI."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"manejo-de-errores-y-respuestas",children:"Manejo de errores y respuestas"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Tipos de errores comunes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"401 / 403 (no autorizado)"}),": limpiar sesi\xf3n y redirigir a Login."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"500 (error del servidor)"}),": informar al usuario con un mensaje gen\xe9rico y permitir reintentos."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Timeout / sin conexi\xf3n"}),": almacenar el intento en cache para sincronizaci\xf3n posterior."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Buenas pr\xe1cticas implementadas:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Uso de ",(0,r.jsx)(n.code,{children:"try/catch"})," para capturar ",(0,r.jsx)(n.code,{children:"DioException"})," y mostrar feedback mediante ",(0,r.jsx)(n.code,{children:"SnackBar"})," o banners."]}),"\n",(0,r.jsx)(n.li,{children:"Normalizaci\xf3n de errores en objetos de respuesta estandarizados."}),"\n",(0,r.jsx)(n.li,{children:"Reintentos autom\xe1ticos en casos de conectividad intermitente."}),"\n",(0,r.jsx)(n.li,{children:"Logging de errores t\xe9cnicos (sin datos sensibles)."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"ejemplo-de-secuencia-encuesta-con-modo-offline",children:"Ejemplo de secuencia (Encuesta con modo offline)"}),"\n",(0,r.jsx)(n.mermaid,{value:'sequenceDiagram\n  participant UI as Formulario (Encuesta)\n  participant SVC as EncuestaService\n  participant CON as ConnectivityService\n  participant ST as SecureStorage/Cache\n  participant BE as Backend\n\n  UI->>SVC: enviarEncuesta(datos)\n  SVC->>CON: hasInternetConnection?\n  alt Sin conexi\xf3n\n    SVC->>ST: guardar borrador en cache\n    SVC--\x3e>UI: "Guardado localmente"\n  else Con conexi\xf3n\n    SVC->>BE: POST /encuestas\n    BE--\x3e>SVC: 200 OK {id, estado}\n    SVC--\x3e>UI: "Enviado con \xe9xito"\n  end\n\n  Note over CON,BE: Al restablecer la conexi\xf3n, el servicio procesa<br/>la cola y sincroniza los env\xedos pendientes.'}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Checklist para trabajar con servicios"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Siempre validar conexi\xf3n antes de llamadas HTTP."}),"\n",(0,r.jsxs)(n.li,{children:["Manejar tokens en cabecera con ",(0,r.jsx)(n.code,{children:"auth_service"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Convertir respuestas JSON en modelos locales claros."}),"\n",(0,r.jsx)(n.li,{children:"Nunca exponer credenciales en logs."}),"\n",(0,r.jsx)(n.li,{children:"Implementar feedback inmediato al usuario (sin conexi\xf3n, error, \xe9xito)."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const r={},c=i.createContext(r);function o(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);