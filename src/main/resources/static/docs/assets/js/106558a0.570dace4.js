"use strict";(self.webpackChunkclias_docs=self.webpackChunkclias_docs||[]).push([[3687],{80:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"dev/chatbot/setup","title":"Chatbot - Integraci\xf3n y Despliegue","description":"---","source":"@site/docs/dev/chatbot/setup.md","sourceDirName":"dev/chatbot","slug":"/dev/chatbot/setup","permalink":"/docs/dev/chatbot/setup","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Chatbot - Integraci\xf3n y Despliegue","sidebar_label":"Integraci\xf3n y Despliegue","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Descripci\xf3n y Funcionalidades","permalink":"/docs/dev/chatbot/description"},"next":{"title":"Introducci\xf3n","permalink":"/docs/dev/frontend_app/introduccion_sisa"}}');var i=s(4848),c=s(8453);const l={title:"Chatbot - Integraci\xf3n y Despliegue",sidebar_label:"Integraci\xf3n y Despliegue",sidebar_position:2},o=void 0,a={},d=[{value:"Estructura del proyecto",id:"estructura-del-proyecto",level:2},{value:"Integraci\xf3n real (App \u2194 Backend \u2194 Rasa)",id:"integraci\xf3n-real-app--backend--rasa",level:2},{value:"Puntos clave para integrar y desplegar",id:"puntos-clave-para-integrar-y-desplegar",level:2},{value:"1) <code>docker-compose.yml</code> \u2014 Orquestaci\xf3n",id:"1-docker-composeyml--orquestaci\xf3n",level:3},{value:"2) <code>config.yml</code> \u2014 Pipeline NLU y Pol\xedticas de di\xe1logo",id:"2-configyml--pipeline-nlu-y-pol\xedticas-de-di\xe1logo",level:3},{value:"3) <code>domain.yml</code> \u2014 Contrato del asistente",id:"3-domainyml--contrato-del-asistente",level:3},{value:"4) <code>endpoints.yml</code> y <code>credentials.yml</code> \u2014 Conexiones",id:"4-endpointsyml-y-credentialsyml--conexiones",level:3},{value:"5) <code>actions/actions.py</code> \u2014 Fallback con LLM (ONNX)",id:"5-actionsactionspy--fallback-con-llm-onnx",level:3},{value:"6) <code>data/</code> y <code>models/</code> \u2014 Entrenamiento",id:"6-data-y-models--entrenamiento",level:2},{value:"7) Seguridad y exposici\xf3n",id:"7-seguridad-y-exposici\xf3n",level:2},{value:"8) \xbfQu\xe9 tocar al <strong>integrar</strong> con el backend?",id:"8-qu\xe9-tocar-al-integrar-con-el-backend",level:2},{value:"9) Operaci\xf3n / Mantenimiento",id:"9-operaci\xf3n--mantenimiento",level:2},{value:"Desplegar / Reiniciar todo",id:"desplegar--reiniciar-todo",level:3},{value:"10) Errores frecuentes y c\xf3mo detectarlos",id:"10-errores-frecuentes-y-c\xf3mo-detectarlos",level:2}];function t(e){const n={admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["Esta p\xe1gina documenta el estado del chatbot en un servidor de producci\xf3n, conjuntamente con  c\xf3mo operan sus componentes (Rasa + acciones con LLM ",(0,i.jsx)(n.strong,{children:"phi3-mini-128k-onnx"})," v\xeda ",(0,i.jsx)(n.code,{children:"onnxruntime-genai"}),") junto al ",(0,i.jsx)(n.strong,{children:"backend"})," y ",(0,i.jsx)(n.strong,{children:"PostgreSQL"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Host (ejemplo): ",(0,i.jsx)(n.code,{children:"ubuntu"}),(0,i.jsx)(n.br,{}),"\n","Ruta del proyecto: ",(0,i.jsx)(n.code,{children:"~/projects/chatbot_fixed/"}),(0,i.jsx)(n.br,{}),"\n","Contenedores activos:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rasa-core"})," \u2192 ",(0,i.jsx)(n.code,{children:"rasa/rasa:3.6.2-full"})," (puerto ",(0,i.jsx)(n.strong,{children:"5005"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rasa-actions"})," \u2192 acciones personalizadas (puerto ",(0,i.jsx)(n.strong,{children:"5055"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"telemedicina_be"})," \u2192 backend (puerto ",(0,i.jsx)(n.strong,{children:"8080"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"postgres_db"})," \u2192 BD (puerto ",(0,i.jsx)(n.strong,{children:"5432"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"estructura-del-proyecto",children:"Estructura del proyecto"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"chatbot/\n\u251c\u2500 actions/ # Acciones personalizadas (Python)\n\u2502 \u251c\u2500 cpu_and_mobile/ # Modelo phi3-mini-128k-onnx (para onnxruntime-genai)\n\u2502 \u251c\u2500 actions.py # Acciones (fallback/generaci\xf3n con LLM)\n\u2502 \u251c\u2500 Dockerfile # Imagen para 'rasa-actions'\n\u2502 \u2514\u2500 requirements.txt\n\u251c\u2500 data/ # Datos de entrenamiento NLU/Core\n\u2502 \u251c\u2500 nlu.yml\n\u2502 \u251c\u2500 rules.yml\n\u2502 \u2514\u2500 stories.yml\n\u251c\u2500 models/ # Modelos Rasa entrenados (.tar.gz)\n\u251c\u2500 results/ # Reportes de entrenamiento/pruebas\n\u251c\u2500 tests/ # Pruebas NLU / Historias\n\u251c\u2500 config.yml # Pipeline NLU + pol\xedticas Core\n\u251c\u2500 credentials.yml # Canales (REST, etc.)\n\u251c\u2500 domain.yml # Intents, entities, slots, responses, actions\n\u251c\u2500 endpoints.yml # Endpoints (actions, tracker, etc.)\n\u2514\u2500 docker-compose.yml # Orquestaci\xf3n de servicios\n"})}),"\n",(0,i.jsx)(n.h2,{id:"integraci\xf3n-real-app--backend--rasa",children:"Integraci\xf3n real (App \u2194 Backend \u2194 Rasa)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["La ",(0,i.jsx)(n.strong,{children:"app SISA (Flutter)"})," env\xeda los mensajes al ",(0,i.jsx)(n.strong,{children:"backend (Spring Boot)"})," autenticado con ",(0,i.jsx)(n.strong,{children:"JWT"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["El ",(0,i.jsx)(n.strong,{children:"backend"})," reenv\xeda el mensaje a ",(0,i.jsx)(n.strong,{children:"Rasa"})," usando el ",(0,i.jsx)(n.strong,{children:"canal REST"})," (",(0,i.jsx)(n.code,{children:"/webhooks/rest/webhook"}),") y ",(0,i.jsx)(n.strong,{children:"persiste"})," la sesi\xf3n en PostgreSQL (",(0,i.jsx)(n.code,{children:"SesionChat"})," y, si se habilita, ",(0,i.jsx)(n.code,{children:"ChatMessage"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Rasa"})," decide la respuesta:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si hay intent claro, responde con ",(0,i.jsx)(n.strong,{children:"plantillas"})," o ",(0,i.jsx)(n.strong,{children:"acciones"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Si no, entra ",(0,i.jsx)(n.strong,{children:"fallback"})," \u2192 llama a ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"rasa-actions"})}),"; all\xed ",(0,i.jsx)(n.code,{children:"actions.py"})," usa ",(0,i.jsx)(n.strong,{children:"phi3-mini-128k-onnx"})," para generar una respuesta ",(0,i.jsx)(n.em,{children:"controlada"})," por ",(0,i.jsx)(n.strong,{children:"prompt"})," (seguridad tem\xe1tica)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.mermaid,{value:'flowchart LR\n    A["SISA (Flutter)"] --\x3e B["Backend Spring Boot + JWT"]\n    B --\x3e C["Rasa Core :5005"]\n    C --\x3e D["Rasa Actions :5055"]\n    D --\x3e E["LLM ONNX phi3-mini-128k"]\n\n    B --\x3e F["PostgreSQL"]\n    C --\x3e F'}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"puntos-clave-para-integrar-y-desplegar",children:"Puntos clave para integrar y desplegar"}),"\n",(0,i.jsxs)(n.h3,{id:"1-docker-composeyml--orquestaci\xf3n",children:["1) ",(0,i.jsx)(n.code,{children:"docker-compose.yml"})," \u2014 Orquestaci\xf3n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 hace?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Levanta ",(0,i.jsx)(n.strong,{children:"2 contenedores"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rasa-core"})," (imagen ",(0,i.jsx)(n.code,{children:"rasa/rasa:3.6.2-full"}),") expuesto en ",(0,i.jsx)(n.strong,{children:":5005"})," con ",(0,i.jsx)(n.code,{children:"--enable-api"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rasa-actions"})," (Dockerfile propio en ",(0,i.jsx)(n.code,{children:"actions/"}),") expuesto en ",(0,i.jsx)(n.strong,{children:":5055"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Monta el ",(0,i.jsx)(n.strong,{children:"directorio del proyecto"})," dentro de ",(0,i.jsx)(n.code,{children:"/app"})," para que Rasa vea ",(0,i.jsx)(n.em,{children:"config.yml, domain.yml, data/, models/"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Une todo en una ",(0,i.jsx)(n.strong,{children:"red interna"})," (",(0,i.jsx)(n.code,{children:"rasa-network"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfPor qu\xe9 importa?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["As\xed el ",(0,i.jsx)(n.strong,{children:"backend"})," solo necesita hablar con ",(0,i.jsx)(n.code,{children:"rasa-core:5005"})," (y Rasa llama internamente a ",(0,i.jsx)(n.code,{children:"rasa-actions:5055"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Separar ",(0,i.jsx)(n.em,{children:"Core"})," y ",(0,i.jsx)(n.em,{children:"Actions"})," permite ",(0,i.jsx)(n.strong,{children:"versionar y escalar"})," la l\xf3gica de acciones sin tocar el NLU."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 debes cambiar?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si ",(0,i.jsx)(n.strong,{children:"no quieres exponer Rasa p\xfablicamente"}),", elimina/evita el mapeo ",(0,i.jsx)(n.code,{children:"5005:5005"})," y haz que ",(0,i.jsx)(n.strong,{children:"solo el backend"})," acceda a Rasa dentro de la red de Docker."]}),"\n",(0,i.jsxs)(n.li,{children:["Si mueves el proyecto, ajusta el ",(0,i.jsx)(n.code,{children:"volumen"})," (",(0,i.jsx)(n.code,{children:"- ./:/app"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Si cambias de puerto de acciones, ",(0,i.jsxs)(n.strong,{children:["actualiza ",(0,i.jsx)(n.code,{children:"endpoints.yml"})]})," (ver \xa74)."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"2-configyml--pipeline-nlu-y-pol\xedticas-de-di\xe1logo",children:["2) ",(0,i.jsx)(n.code,{children:"config.yml"})," \u2014 Pipeline NLU y Pol\xedticas de di\xe1logo"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 hace?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Define ",(0,i.jsx)(n.strong,{children:"pipeline"})," en ",(0,i.jsx)(n.em,{children:"espa\xf1ol"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WhitespaceTokenizer"})," + ",(0,i.jsx)(n.code,{children:"RegexFeaturizer"}),": tokenizaci\xf3n y patrones."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CountVectorsFeaturizer"})," (palabras y ",(0,i.jsx)(n.em,{children:"char n-grams"})," 2\u20134): robustez ante ",(0,i.jsx)(n.strong,{children:"errores tipogr\xe1ficos"})," y variaciones."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DIETClassifier"}),": ",(0,i.jsx)(n.strong,{children:"intents/entidades"})," (200 \xe9pocas, LR=0.002)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ResponseSelector"}),": ",(0,i.jsx)(n.em,{children:"retrieval intents"})," (pregunta \u2192 respuesta)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FallbackClassifier"}),": umbrales ",(0,i.jsx)(n.code,{children:"threshold=0.3"}),", ",(0,i.jsx)(n.code,{children:"ambiguity_threshold=0.02"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Define ",(0,i.jsx)(n.strong,{children:"pol\xedticas"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RulePolicy"})," con ",(0,i.jsx)(n.code,{children:"core_fallback_action_name: action_default_fallback"})," (umbral 0.53)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TEDPolicy"})," + ",(0,i.jsx)(n.code,{children:"Memoization"})," para el flujo."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"UnexpecTEDIntentPolicy"})," para detectar ",(0,i.jsx)(n.strong,{children:"intenciones inesperadas"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfPor qu\xe9 importa?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Los ",(0,i.jsx)(n.strong,{children:"umbrales"})," controlan ",(0,i.jsx)(n.em,{children:"cu\xe1ndo"})," se considera incierta una predicci\xf3n \u2192 aqu\xed entra el ",(0,i.jsx)(n.strong,{children:"fallback"})," que llama al LLM (seguro con prompt)."]}),"\n",(0,i.jsxs)(n.li,{children:["Los ",(0,i.jsx)(n.em,{children:"char n-grams"})," hacen que el chatbot ",(0,i.jsx)(n.strong,{children:"entienda variantes"})," y faltas de ortograf\xeda."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 debes ajustar?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si el bot ",(0,i.jsx)(n.strong,{children:"responde con demasiada facilidad"}),", ",(0,i.jsx)(n.strong,{children:"sube"})," ",(0,i.jsx)(n.code,{children:"FallbackClassifier.threshold"})," (menos \u201cvaliente\u201d)."]}),"\n",(0,i.jsxs)(n.li,{children:["Si el bot ",(0,i.jsx)(n.strong,{children:"entra en fallback muy pronto"}),", ",(0,i.jsx)(n.strong,{children:"baja"})," ese valor (m\xe1s \u201cvaliente\u201d)."]}),"\n",(0,i.jsxs)(n.li,{children:["Ajusta ",(0,i.jsx)(n.code,{children:"epochs"}),"/",(0,i.jsx)(n.code,{children:"learning_rate"})," si reentrenas y notas ",(0,i.jsx)(n.strong,{children:"sobreajuste"})," o ",(0,i.jsx)(n.strong,{children:"bajo recall"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"3-domainyml--contrato-del-asistente",children:["3) ",(0,i.jsx)(n.code,{children:"domain.yml"})," \u2014 Contrato del asistente"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 contiene?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"intents"}),", ",(0,i.jsx)(n.code,{children:"entities"}),", ",(0,i.jsx)(n.code,{children:"slots"}),", ",(0,i.jsx)(n.code,{children:"responses"}),", ",(0,i.jsx)(n.code,{children:"actions"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Lista la acci\xf3n ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"action_default_fallback"})})," y, si aplica, ",(0,i.jsx)(n.code,{children:"action_consult_info"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfPor qu\xe9 importa?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Es el ",(0,i.jsx)(n.strong,{children:"contrato"})," entre NLU/Core y tu c\xf3digo de acciones.",(0,i.jsx)(n.br,{}),"\n","Si no declaras una acci\xf3n aqu\xed, ",(0,i.jsx)(n.strong,{children:"Rasa no la invocar\xe1"})," aunque exista en ",(0,i.jsx)(n.code,{children:"actions.py"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 debes cambiar?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Cada vez que agregues una acci\xf3n nueva en Python, ",(0,i.jsx)(n.strong,{children:"decl\xe1rala"})," en ",(0,i.jsx)(n.code,{children:"domain.yml"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Mant\xe9n ",(0,i.jsx)(n.code,{children:"responses:"})," para mensajes ",(0,i.jsx)(n.strong,{children:"est\xe1ticos"})," (m\xe1s r\xe1pidos y controlables que el LLM)."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"4-endpointsyml-y-credentialsyml--conexiones",children:["4) ",(0,i.jsx)(n.code,{children:"endpoints.yml"})," y ",(0,i.jsx)(n.code,{children:"credentials.yml"})," \u2014 Conexiones"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"endpoints.yml"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Apunta ",(0,i.jsx)(n.strong,{children:"acciones"})," a ",(0,i.jsx)(n.code,{children:"http://rasa-actions:5055/webhook"})," (dentro de la red Docker)."]}),"\n",(0,i.jsx)(n.li,{children:"Si cambias el puerto/servicio de acciones, actualiza aqu\xed."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"credentials.yml"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Activa el ",(0,i.jsxs)(n.strong,{children:["canal ",(0,i.jsx)(n.code,{children:"rest:"})]})," para ",(0,i.jsx)(n.code,{children:"POST /webhooks/rest/webhook"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"No expongas otros canales (facebook, telegram, etc.) si no los usas."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"5-actionsactionspy--fallback-con-llm-onnx",children:["5) ",(0,i.jsx)(n.code,{children:"actions/actions.py"})," \u2014 Fallback con LLM (ONNX)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 hace?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Carga ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"phi3-mini-128k-onnx"})})," (v\xeda ",(0,i.jsx)(n.code,{children:"onnxruntime_genai"}),") y su tokenizador."]}),"\n",(0,i.jsxs)(n.li,{children:["Define un ",(0,i.jsx)(n.strong,{children:"prompt"})," restrictivo (temas permitidos, tono, ",(0,i.jsx)(n.em,{children:"out-of-domain"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Implementa:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"action_consult_info"}),": generaci\xf3n bajo demanda."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"action_default_fallback"}),": se dispara en ",(0,i.jsx)(n.strong,{children:"incertidumbre"}),"; genera con LLM y ",(0,i.jsx)(n.strong,{children:"revierte"})," el \xfaltimo ",(0,i.jsx)(n.em,{children:"user_utterance"})," para no \u201ccontaminar\u201d la historia."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfPor qu\xe9 importa?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["El LLM ",(0,i.jsx)(n.strong,{children:"no responde cualquier cosa"}),": el prompt obliga a ce\xf1irse a ",(0,i.jsx)(n.strong,{children:"salud sexual/VPH"})," y a recomendar acudir a profesionales cuando corresponda."]}),"\n",(0,i.jsxs)(n.li,{children:["Usar ONNX permite ",(0,i.jsx)(n.strong,{children:"despliegue portable"})," (sin GPU), a costa de calentamiento inicial."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 debes cambiar?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ruta del modelo"})," si lo mueves: ",(0,i.jsx)(n.code,{children:"/app/cpu_and_mobile/phi3-mini-128k-onnx"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Par\xe1metros de generaci\xf3n"})," (",(0,i.jsx)(n.code,{children:"temperature"}),", ",(0,i.jsx)(n.code,{children:"max_new_tokens"}),") seg\xfan calidad/latencia."]}),"\n",(0,i.jsxs)(n.li,{children:["Refuerza el ",(0,i.jsx)(n.strong,{children:"prompt"})," si detectas respuestas fuera de tema."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"6-data-y-models--entrenamiento",children:["6) ",(0,i.jsx)(n.code,{children:"data/"})," y ",(0,i.jsx)(n.code,{children:"models/"})," \u2014 Entrenamiento"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"data/"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"nlu.yml"}),", ",(0,i.jsx)(n.code,{children:"rules.yml"}),", ",(0,i.jsx)(n.code,{children:"stories.yml"})," \u2014 el ",(0,i.jsx)(n.strong,{children:"dataset"}),".",(0,i.jsx)(n.br,{}),"\n","Cambios aqu\xed requieren ",(0,i.jsx)(n.strong,{children:"reentrenar"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"models/"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Paquetes ",(0,i.jsx)(n.code,{children:".tar.gz"})," entrenados (",(0,i.jsx)(n.code,{children:"rasa train"}),").",(0,i.jsx)(n.br,{}),"\n","La ",(0,i.jsx)(n.strong,{children:"versi\xf3n activa"})," es la que Rasa encuentra en ",(0,i.jsx)(n.code,{children:"models/"})," al arrancar."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Versiona los ",(0,i.jsx)(n.code,{children:".tar.gz"})," estables (n\xf3mbrelos con fecha)."]}),"\n",(0,i.jsxs)(n.li,{children:["Guarda ",(0,i.jsx)(n.strong,{children:"matrices de confusi\xf3n"})," y ",(0,i.jsx)(n.strong,{children:"errores de intent"})," (carpeta ",(0,i.jsx)(n.code,{children:"results/"}),") tras cada entrenamiento."]}),"\n"]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"7-seguridad-y-exposici\xf3n",children:"7) Seguridad y exposici\xf3n"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["En producci\xf3n, ",(0,i.jsx)(n.strong,{children:"no"})," expongas ",(0,i.jsx)(n.code,{children:"5005"}),"/",(0,i.jsx)(n.code,{children:"5055"})," al exterior; deja que ",(0,i.jsx)(n.strong,{children:"solo el backend"})," los vea por red interna."]}),"\n",(0,i.jsxs)(n.li,{children:["El backend ",(0,i.jsx)(n.strong,{children:"valida JWT"})," y ",(0,i.jsx)(n.strong,{children:"persiste"})," en PostgreSQL (",(0,i.jsx)(n.code,{children:"SesionChat"}),", y opcional ",(0,i.jsx)(n.code,{children:"ChatMessage"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Aplica ",(0,i.jsx)(n.strong,{children:"rate limiting"})," por IP/usuario en backend para proteger a Rasa/Actions."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"8-qu\xe9-tocar-al-integrar-con-el-backend",children:["8) \xbfQu\xe9 tocar al ",(0,i.jsx)(n.strong,{children:"integrar"})," con el backend?"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"URL interna"})," de Rasa para el backend (por ejemplo, ",(0,i.jsx)(n.code,{children:"http://rasa-core:5005"})," si comparten red)."]}),"\n",(0,i.jsxs)(n.li,{children:["Endpoint REST:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"POST /webhooks/rest/webhook"})}),", body:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{ "sender": "<sessionId|userId>", "message": "<texto del usuario>" }\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"9-operaci\xf3n--mantenimiento",children:"9) Operaci\xf3n / Mantenimiento"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f Aseg\xfarate de estar en la carpeta del proyecto ",(0,i.jsx)(n.code,{children:"~/projects/chatbot/"})," antes de ejecutar los comandos."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"desplegar--reiniciar-todo",children:"Desplegar / Reiniciar todo"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash*",children:"sudo docker-compose down\nsudo docker-compose up -d --build\n"})}),"\n",(0,i.jsx)(n.h2,{id:"10-errores-frecuentes-y-c\xf3mo-detectarlos",children:"10) Errores frecuentes y c\xf3mo detectarlos"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rasa no llama a acciones"})," \u2192 Revisa ",(0,i.jsx)(n.code,{children:"endpoints.yml"})," (URL de actions) y ",(0,i.jsx)(n.code,{children:"domain.yml"})," (acciones declaradas)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fallback siempre"})," \u2192 Umbrales (",(0,i.jsx)(n.code,{children:"FallbackClassifier.threshold"})," / ",(0,i.jsx)(n.code,{children:"RulePolicy.core_fallback_threshold"}),") demasiado altos, dataset pobre o desbalanceado."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"LLM tarda en la primera respuesta"})," \u2192 ",(0,i.jsx)(n.em,{children:"Warm-up"})," de ONNX; considera precalentar en ",(0,i.jsx)(n.code,{children:"__init__"})," o al arrancar el servicio."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Respuestas fuera de tema"})," \u2192 Reforzar ",(0,i.jsx)(n.strong,{children:"prompt"})," en ",(0,i.jsx)(n.code,{children:"actions.py"}),", bajar ",(0,i.jsx)(n.code,{children:"temperature"}),", revisar l\xedmites del fallback."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Modelos no cambian al reiniciar"})," \u2192 Confirmar que el nuevo ",(0,i.jsx)(n.code,{children:".tar.gz"})," est\xe1 en ",(0,i.jsx)(n.code,{children:"models/"})," y que Rasa se reinici\xf3."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var r=s(6540);const i={},c=r.createContext(i);function l(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);