"use strict";(self.webpackChunkclias_docs=self.webpackChunkclias_docs||[]).push([[647],{4302:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"dev/Notificaciones/description","title":"Notificaciones - Introducci\xf3n","description":"---","source":"@site/docs/dev/Notificaciones/description.md","sourceDirName":"dev/Notificaciones","slug":"/dev/Notificaciones/description","permalink":"/docs/dev/Notificaciones/description","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"title":"Notificaciones - Introducci\xf3n","sidebar_label":"Introducci\xf3n","sidebar_position":0},"sidebar":"tutorialSidebar","previous":{"title":"Despliegue","permalink":"/docs/dev/Backend/setup"},"next":{"title":"Manejo en la app m\xf3vil","permalink":"/docs/dev/Notificaciones/notificaciones_movil"}}');var c=n(4848),r=n(8453);const a={title:"Notificaciones - Introducci\xf3n",sidebar_label:"Introducci\xf3n",sidebar_position:0},o=void 0,d={},l=[{value:"Tipos de notificaci\xf3n activos",id:"tipos-de-notificaci\xf3n-activos",level:2},{value:"Estructura de la notificaci\xf3n",id:"estructura-de-la-notificaci\xf3n",level:2},{value:"Entidad/Respuesta base (persistencia y API)",id:"entidadrespuesta-base-persistencia-y-api",level:3},{value:"Plantilla programada (scheduler de recordatorios)",id:"plantilla-programada-scheduler-de-recordatorios",level:3},{value:"Registro de dispositivos y env\xedo de push",id:"registro-de-dispositivos-y-env\xedo-de-push",level:2}];function t(e){const i={blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"tipos-de-notificaci\xf3n-activos",children:"Tipos de notificaci\xf3n activos"}),"\n",(0,c.jsxs)(i.blockquote,{children:["\n",(0,c.jsxs)(i.p,{children:["En el backend solo existen automatizaciones para los ",(0,c.jsx)(i.strong,{children:"tres primeros"})," tipos."]}),"\n"]}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["\n",(0,c.jsxs)(i.p,{children:[(0,c.jsx)(i.strong,{children:"RESULTADO"}),(0,c.jsx)(i.br,{}),"\n","Se env\xeda cuando la doctora sube el resultado en el frontend administrativo ",(0,c.jsx)(i.em,{children:"(web)"}),". Dispara un push al/los dispositivo(s) del usuario y adem\xe1s ",(0,c.jsx)(i.strong,{children:"inicia un plan de notificaciones programadas"})," (recordatorios) relacionados a completar la encuesta SUS / revisar resultado."]}),"\n"]}),"\n",(0,c.jsxs)(i.li,{children:["\n",(0,c.jsxs)(i.p,{children:[(0,c.jsx)(i.strong,{children:"RECORDATORIO_NO_EXAMEN"}),(0,c.jsx)(i.br,{}),"\n","Recordatorio para usuarias que ",(0,c.jsx)(i.strong,{children:"a\xfan no tienen un examen registrado"})," (no aparece un examen asociado al paciente). Se env\xeda de forma programada; si detecta que ya existe examen, ",(0,c.jsx)(i.strong,{children:"se desactiva autom\xe1ticamente"}),"."]}),"\n"]}),"\n",(0,c.jsxs)(i.li,{children:["\n",(0,c.jsxs)(i.p,{children:[(0,c.jsx)(i.strong,{children:"RECORDATORIO_NO_ENTREGA_DISPOSITIVO"}),(0,c.jsx)(i.br,{}),"\n","Recordatorio para confirmar la ",(0,c.jsx)(i.strong,{children:"entrega del dispositivo"})," de automuestreo. Si el backend detecta que el examen ya fue entregado (contenido disponible), ",(0,c.jsx)(i.strong,{children:"se desactiva autom\xe1ticamente"}),". La app permite al usuario confirmar y solicitar que se deje de recordar."]}),"\n"]}),"\n",(0,c.jsxs)(i.li,{children:["\n",(0,c.jsxs)(i.p,{children:[(0,c.jsx)(i.strong,{children:"BIENVENIDA"})," ",(0,c.jsx)(i.em,{children:"(opcional, sin automatizaciones en backend)"}),(0,c.jsx)(i.br,{}),"\n","La app m\xf3vil puede ",(0,c.jsx)(i.strong,{children:"crear una notificaci\xf3n de bienvenida"})," (v\xeda ",(0,c.jsx)(i.code,{children:"/notificaciones"}),") y adem\xe1s mostrar un ",(0,c.jsx)(i.strong,{children:"banner local"}),". El backend la persiste como cualquier notificaci\xf3n, pero ",(0,c.jsx)(i.strong,{children:"no tiene l\xf3gica programada asociada"})," (no inicia plan recurrente)."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(i.blockquote,{children:["\n",(0,c.jsx)(i.p,{children:(0,c.jsx)(i.strong,{children:"Resumen de alcance"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["Backend con l\xf3gica de negocio/automatizaci\xf3n: ",(0,c.jsx)(i.strong,{children:"RESULTADO"}),", ",(0,c.jsx)(i.strong,{children:"RECORDATORIO_NO_EXAMEN"}),", ",(0,c.jsx)(i.strong,{children:"RECORDATORIO_NO_ENTREGA_DISPOSITIVO"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:["Backend \u201cpasivo\u201d (solo persiste/empush-a): ",(0,c.jsx)(i.strong,{children:"BIENVENIDA"})," (cuando el frontend m\xf3vil lo solicita)."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"NUEVO_RECURSO"}),": ",(0,c.jsx)(i.em,{children:"No se ha usado por lo que est\xe1 desactivado en el frontend m\xf3vil"}),"."]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"estructura-de-la-notificaci\xf3n",children:"Estructura de la notificaci\xf3n"}),"\n",(0,c.jsx)(i.h3,{id:"entidadrespuesta-base-persistencia-y-api",children:"Entidad/Respuesta base (persistencia y API)"}),"\n",(0,c.jsxs)(i.p,{children:["Una ",(0,c.jsx)(i.strong,{children:"notificaci\xf3n \u201creal\u201d"})," que ve la usuaria se modela y expone con los atributos:"]}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"publicId"})," (UUID): Identificador p\xfablico de la notificaci\xf3n."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"cuentaUsuarioPublicId"})," (UUID): A qui\xe9n pertenece."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"titulo"})," (String): Encabezado visible en el push/listado."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"mensaje"})," (String): Bontenido visible."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"tipoNotificacion"})," (Enum): ",(0,c.jsx)(i.code,{children:"RESULTADO"}),", ",(0,c.jsx)(i.code,{children:"RECORDATORIO_NO_EXAMEN"}),", ",(0,c.jsx)(i.code,{children:"RECORDATORIO_NO_ENTREGA_DISPOSITIVO"}),", ",(0,c.jsx)(i.code,{children:"BIENVENIDA"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"tipoAccion"})," (Enum): Tipo de acci\xf3n asociada (interno de la app)."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"accion"})," (String): Ruta interna o ",(0,c.jsx)(i.strong,{children:"URL externa"})," a abrir cuando la usuaria toca la notificaci\xf3n."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"fechaCreacion"})," (DateTime): Momento en que se cre\xf3 la notificaci\xf3n (o inicio en el caso de plantillas programadas)."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"notificacionLeida"})," (Boolean): Estado de lectura (se marca al tocarla)."]}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:(0,c.jsx)(i.strong,{children:"Uso en backend al crear una notificaci\xf3n \u201creal\u201d"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["El servicio ",(0,c.jsx)(i.code,{children:"NotificacionService.crearNotificacion(...)"})," ",(0,c.jsx)(i.strong,{children:"persiste"})," y ",(0,c.jsx)(i.strong,{children:"dispara"})," un push:",(0,c.jsx)(i.br,{}),"\n",(0,c.jsx)(i.code,{children:"pushNotificacionService.enviarPushFCM(cuentaUsuario.publicId, notificacionResponse)"}),"\n",(0,c.jsxs)(i.blockquote,{children:["\n",(0,c.jsxs)(i.p,{children:["Esto env\xeda a ",(0,c.jsx)(i.strong,{children:"todos los dispositivos"})," FCM v\xe1lidos asociados a la cuenta."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(i.h3,{id:"plantilla-programada-scheduler-de-recordatorios",children:"Plantilla programada (scheduler de recordatorios)"}),"\n",(0,c.jsxs)(i.p,{children:["Para notificaciones recurrentes (recordatorios) se maneja una ",(0,c.jsx)(i.strong,{children:"plantilla programada"}),", con atributos clave:"]}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"tipoNotificacion"}),": el tipo que se va a ir instanciando (p. ej., ",(0,c.jsx)(i.code,{children:"RESULTADO"}),", ",(0,c.jsx)(i.code,{children:"RECORDATORIO_NO_EXAMEN"}),", ",(0,c.jsx)(i.code,{children:"RECORDATORIO_NO_ENTREGA_DISPOSITIVO"}),")."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"titulo"}),", ",(0,c.jsx)(i.code,{children:"mensaje"}),", ",(0,c.jsx)(i.code,{children:"tipoAccion"}),", ",(0,c.jsx)(i.code,{children:"accion"}),": contenido base que heredan las instancias reales."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"fechaInicio"})," (DateTime): desde cu\xe1ndo corre el plan."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"proxFecha"})," (DateTime): ",(0,c.jsx)(i.strong,{children:"pr\xf3xima ejecuci\xf3n"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"limiteFecha"})," (DateTime, opcional): fecha m\xe1xima para enviar recordatorios."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"programacionActiva"})," (Boolean): habilita/inhabilita la programaci\xf3n."]}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:(0,c.jsx)(i.strong,{children:"Cadencia y autocancelaci\xf3n"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["Cadencia din\xe1mica al procesar:","\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"0\u201330 d\xedas"})," desde ",(0,c.jsx)(i.code,{children:"fechaInicio"}),": cada ",(0,c.jsx)(i.strong,{children:"3 d\xedas"})]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"31\u201360 d\xedas"}),": cada ",(0,c.jsx)(i.strong,{children:"7 d\xedas"})]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:">60 d\xedas"}),": ",(0,c.jsx)(i.strong,{children:"se detiene"})]}),"\n",(0,c.jsxs)(i.li,{children:["Si ",(0,c.jsx)(i.code,{children:"limiteFecha"})," se cumpli\xf3, tambi\xe9n se detiene."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"Reglas de apagado autom\xe1tico antes de instanciar:"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"RECORDATORIO_NO_EXAMEN"}),": si ya existe examen del paciente \u2192 ",(0,c.jsx)(i.strong,{children:"desactivar"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"RECORDATORIO_NO_ENTREGA_DISPOSITIVO"}),": si el examen consta ",(0,c.jsx)(i.strong,{children:"entregado"})," \u2192 ",(0,c.jsx)(i.strong,{children:"desactivar"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"RESULTADO"}),": si la usuaria ",(0,c.jsx)(i.strong,{children:"ya respondi\xf3 encuesta SUS"})," \u2192 ",(0,c.jsx)(i.strong,{children:"desactivar"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(i.blockquote,{children:["\n",(0,c.jsxs)(i.p,{children:["La ejecuci\xf3n se realiza en ",(0,c.jsx)(i.code,{children:"NotificacionService.procesarNotificacionesProgramadas()"}),", que:"]}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsx)(i.li,{children:"valida condiciones,"}),"\n",(0,c.jsxs)(i.li,{children:["crea la ",(0,c.jsx)(i.strong,{children:"notificaci\xf3n real"})," (y por ende dispara el push),"]}),"\n",(0,c.jsxs)(i.li,{children:["actualiza ",(0,c.jsx)(i.code,{children:"proxFecha"})," o apaga la programaci\xf3n."]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"registro-de-dispositivos-y-env\xedo-de-push",children:"Registro de dispositivos y env\xedo de push"}),"\n",(0,c.jsx)(i.p,{children:"Para poder recibir push, la app m\xf3vil:"}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsxs)(i.li,{children:["Solicita permisos FCM y obtiene ",(0,c.jsx)(i.strong,{children:"token FCM"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:["Llama a ",(0,c.jsx)(i.strong,{children:(0,c.jsx)(i.code,{children:"POST /dispositivo"})})," con:","\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"usuarioPublicId"})," (UUID)"]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"fcmToken"})," (String)"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(i.li,{children:["El backend asocia el token al usuario (puede haber ",(0,c.jsx)(i.strong,{children:"m\xfaltiples dispositivos"}),")."]}),"\n",(0,c.jsxs)(i.li,{children:["Al crear una notificaci\xf3n, el backend ",(0,c.jsx)(i.strong,{children:"env\xeda el push a todos"})," los tokens activos del usuario."]}),"\n"]}),"\n",(0,c.jsxs)(i.blockquote,{children:["\n",(0,c.jsxs)(i.p,{children:["En Flutter, esto vive en ",(0,c.jsx)(i.code,{children:"NotificationService.registrarTokenFCM(...)"}),".",(0,c.jsx)(i.br,{}),"\n","En backend, el env\xedo se resuelve v\xeda ",(0,c.jsx)(i.code,{children:"PushNotificacionServiceInterface.enviarPushFCM(...)"}),"."]}),"\n"]}),"\n",(0,c.jsx)(i.hr,{})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,c.jsx)(i,{...e,children:(0,c.jsx)(t,{...e})}):t(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>o});var s=n(6540);const c={},r=s.createContext(c);function a(e){const i=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);